Commands for Datacrunch

Creating json files
python3 convert.py --noisy_dir /mnt/dns1-repo/noisy --clean_dir /mnt/dns1-repo/clean --noisy_json_location /mnt/noisy.json --clean_json_location /mnt/clean.json --memory_th 200

Generating tfrecords
python3 convert_tf_record.py -n /mnt/noisy.json -c /mnt/clean.json -o /mnt/tfrecords --num-shards-train 480 --num-shards-test 120 --num-shards-val 0 --duration 10 --test-size 0.2 --val-size 0.0 --core 32


Before Training
apt update
source /mnt/tf/bin/activate
apt install libcudnn8
git pull

Training models
timedatectl && python3 train.py --autotune 16 --tfrecords_dir /mnt/tfrecords --checkpoints_dir /mnt/outputs-18-4 --epochs 200 --steps_per_epoch 120 --batch_size 32 --sample_rate 48000 --total_seconds_of_audio 10 | tee -a log.txt

timedatectl && python3 train.py --autotune 8 --tfrecords_dir /mnt/tfrecords --checkpoints_dir /mnt/outputs-14-4 --epochs 200 --steps_per_epoch 1120 --batch_size 32 --sample_rate 48000 --total_seconds_of_audio 10 | tee log.txt

timedatectl && python3 train_diffq.py --autotune 16 --tfrecords_dir /mnt/tfrecords --checkpoints_dir /mnt/outputs-13-6 --epochs 200 --steps_per_epoch 200 --batch_size 24 --sample_rate 48000 --total_seconds_of_audio 10 --penalty 0.01 |& tee -a diffq_log.txt


Uploading model to gdrive
./gdrive upload /mnt/outputs-13-4/checkpoint_epoch-008


nvidia error
apt-key del 7fa2af80
rm /etc/apt/sources.list.d/cuda.list
rm /etc/apt/sources.list.d/nvidia-ml.list
wget https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64/cuda-keyring_1.0-1_all.deb
dpkg -i cuda-keyring_1.0-1_all.deb

gpu debug
nvidia-smi --query-gpu=utilization.gpu --format=csv -l 1





python3 convert.py --noisy_dir /home/reyaj/Documents/Test/noisy --clean_dir /home/reyaj/Documents/Test/clean --noisy_json_location /home/reyaj/Documents/Test/noisy.json --clean_json_location /home/reyaj/Documents/Test/clean.json --memory_th 200

timedatectl &&  ls clean | wc -l && ls noisy | wc -l && ls noise | wc -l

timedatectl && python3 train.py --autotune 6 --tfrecords_dir /mnt/tfrecords --checkpoints_dir /mnt/outputs-13-4 --epochs 200 --steps_per_epoch 180000*.8/(B*G) --batch_size B --sample_rate 48000 --total_seconds_of_audio 10



timedatectl && python3 /media/inverseai/432e68df-5f7f-44a3-ac5b-f984da69470d/inverseai/train/noise_reducer_16k_last/noise-reducer-ml/denoiser-inverse/train.py  --autotune 32 --tfrecords_dir /media/inverseai/432e68df-5f7f-44a3-ac5b-f984da69470d/inverseai/tfrecords --checkpoints_dir /media/inverseai/432e68df-5f7f-44a3-ac5b-f984da69470d/inverseai/train/noise_reducer_16k_last/checkpoints --epochs 300 --steps_per_epoch 36000 --batch_size 16 --sample_rate 16000 --total_seconds_of_audio 10 | tee -a /media/inverseai/432e68df-5f7f-44a3-ac5b-f984da69470d/inverseai/train/noise_reducer_16k_last/noise-reducer-ml/denoiser-inverse/train_log.txt



If your nvidia-smi failed to communicate but you've installed the driver so many times, check prime-select:

If it says nvidia is already selected, select a different one, e.g. prime-select intel, then switch back to nvidia prime-select nvidia
Reboot and check nvidia-smi